(function(f,g){var a=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;var c=window.IDBKeyRange||window.webkitIDBKeyRange;var e=window.IDBCursor||window.webkitIDBCursor||{};Object.defineProperty(e,"NEXT",{get:function(){return"next"}});Object.defineProperty(e,"NEXTUNIQUE",{get:function(){return"nextunique"}});Object.defineProperty(e,"PREV",{get:function(){return"prev"}});Object.defineProperty(e,"PREVUNIQUE",{get:function(){return"prevunique"}});var d=window.IDBTransaction||window.webkitIDBTransaction;function b(i){var h=null;switch(i){case 0:case 1:case"readwrite":case"readonly":h=i;break;default:h=d.READ_WRITE||"readwrite"}return h}f.extend({"indexedDB":function(n,k){if(k){if(typeof k==="number"){k={"version":k}}var j=k.version;if(k.schema&&!j){var i=-1;for(var l in k.schema){i=i>l?i:l}j=k.version||i}}var m={"request":function(p,o){return f.Deferred(function(q){try{var r=typeof p==="function"?p(o):p;r.onsuccess=function(t){q.resolveWith(r,[r.result,t])};r.onerror=function(t){q.rejectWith(r,[r.error,t])};if(typeof r.onblocked!=="undefined"&&r.onblocked===null){r.onblocked=function(u){var t;try{t=r.result}catch(u){t=null}q.notifyWith(r,[t,u])}}if(typeof r.onupgradeneeded!=="undefined"&&r.onupgradeneeded===null){r.onupgradeneeded=function(t){q.notifyWith(r,[r.result,t])}}}catch(s){s.name="exception";q.rejectWith(r,["exception",s])}})},"transaction":function(o){return{"objectStore":function(p){try{return m.objectStore(o.objectStore(p))}catch(q){o.readyState!==o.DONE&&o.abort();return m.objectStore(null)}},"createObjectStore":function(q,p){try{return m.objectStore(o.db.createObjectStore(q,p))}catch(r){o.readyState!==o.DONE&&o.abort()}},"deleteObjectStore":function(p){try{o.db.deleteObjectStore(p)}catch(q){o.readyState!==o.DONE&&o.abort()}},"abort":function(){o.abort()}}},"objectStore":function(p){var o={};var r=["add","put","get","delete","clear","count"];for(var q=0;q<r.length;q++){o[r[q]]=(function(s){return function(){return m.request(function(t){return p[s].apply(p,t)},arguments)}})(r[q])}o.each=function(u,s,t){return m.cursor(function(){if(t){return p.openCursor(m.range(s),t)}else{return p.openCursor(m.range(s))}},u)};o.index=function(s){return m.index(function(){return p.index(s)})};o.createIndex=function(u,s,t){if(arguments.length===2&&typeof s==="string"){t=arguments[1];s=null}if(!t){t=u}return m.index(function(){return p.createIndex(t,u,s)})};o.deleteIndex=function(s){return p.deleteIndex(s)};return o},"range":function(o){if(f.isArray(o)){if(o.length===1){return c.only(o[0])}else{return c.bound(o[0],o[1],(typeof o[2]==="undefined")?false:o[2],(typeof o[3]==="undefined")?false:o[3])}}else{if(typeof o==="undefined"){return null}else{return o}}},"cursor":function(p,o){return f.Deferred(function(q){try{var r=typeof p==="function"?p():p;r.onsuccess=function(v){if(!r.result){q.resolveWith(r,[null,v]);return}var u={"delete":function(){return m.request(function(){return r.result["delete"]()})},"update":function(w){return m.request(function(){return r.result["update"](w)})},"next":function(w){this.data=w},"key":r.result.key,"value":r.result.value};q.notifyWith(r,[u,v]);var t=o.apply(r,[u]);try{if(t===false){q.resolveWith(r,[null,v])}else{if(typeof t==="number"){r.result["advance"].apply(r.result,[t])}else{if(u.data){r.result["continue"].apply(r.result,[u.data])}else{r.result["continue"]()}}}}catch(v){q.rejectWith(r,[r.result,v])}};r.onerror=function(t){q.rejectWith(r,[r.result,t])}}catch(s){s.type="exception";q.rejectWith(r,[null,s])}})},"index":function(p){try{var o=(typeof p==="function"?p():p)}catch(q){o=null}return{"each":function(t,r,s){return m.cursor(function(){if(s){return o.openCursor(m.range(r),s)}else{return o.openCursor(m.range(r))}},t)},"eachKey":function(t,r,s){return m.cursor(function(){if(s){return o.openKeyCursor(m.range(r),s)}else{return o.openKeyCursor(m.range(r))}},t)},"get":function(r){if(typeof o.get==="function"){return m.request(o.get(r))}else{return o.openCursor(m.range(r))}},"count":function(){if(typeof o.count==="function"){return m.request(o.count())}else{throw"Count not implemented for cursors"}},"getKey":function(r){if(typeof o.getKey==="function"){return m.request(o.getKey(r))}else{return o.openKeyCursor(m.range(r))}}}}};var h=m.request(function(){return j?a.open(n,parseInt(j)):a.open(n)});h.then(function(o,p){o.onversionchange=function(){if(!(k&&k.onversionchange&&k.onversionchange()!==false)){o.close()}}},function(o,p){},function(o,q){if(q&&q.type==="upgradeneeded"){if(k&&k.schema){for(var p=q.oldVersion+1;p<=q.newVersion;p++){typeof k.schema[p]==="function"&&k.schema[p].call(this,m.transaction(this.transaction))}}if(k&&typeof k.upgrade==="function"){k.upgrade.call(this,m.transaction(this.transaction))}}});return f.extend(h,{"cmp":function(p,o){return a.cmp(p,o)},"deleteDatabase":function(){return f.Deferred(function(o){h.then(function(p,q){p.close();m.request(function(){return a.deleteDatabase(n)}).then(function(r,s){o.resolveWith(this,[r,s])},function(r,s){o.rejectWith(this,[r,s])},function(r,s){o.notifyWith(this,[r,s])})},function(p,q){o.rejectWith(this,[p,q])},function(p,q){o.notifyWith(this,[p,q])})})},"transaction":function(o,p){!f.isArray(o)&&(o=[o]);p=b(p);return f.Deferred(function(q){h.then(function(r,t){var s;try{s=r.transaction(o,p);s.onabort=s.onerror=function(u){q.rejectWith(s,[u])};s.oncomplete=function(u){q.resolveWith(s,[u])}}catch(t){t.type="exception";q.rejectWith(this,[t]);return}try{q.notifyWith(s,[m.transaction(s)])}catch(t){t.type="exception";q.rejectWith(this,[t])}},function(r,s){q.rejectWith(this,[s,r])},function(r,s){})})},"objectStore":function(u,s){var t=this,w={};function r(x){return f.Deferred(function(y){function z(A,C){try{C(A.objectStore(u)).then(function(D,E){y.resolveWith(this,[D,E])},function(D,E){y.rejectWith(this,[D,E])})}catch(B){B.name="exception";y.rejectWith(A,[B,B])}}t.transaction(u,b(s)).then(function(){},function(B,C){if(B.code===B.NOT_FOUND_ERR&&(s===true||typeof s==="object")){var A=this.result;A.close();h=m.request(function(){return a.open(n,(parseInt(A.version,10)||1)+1)});h.then(function(D,E){D.onversionchange=function(){if(!(k&&k.onversionchange&&k.onversionchange()!==false)){D.close()}};t.transaction(u,b(s)).then(function(){},function(F,G){y.rejectWith(this,[F,G])},function(F,G){z(F,x)})},function(D,E){y.rejectWith(this,[D,E])},function(D,F){if(F.type==="upgradeneeded"){try{D.createObjectStore(u,s===true?{"autoIncrement":true}:s)}catch(E){y.rejectWith(this,[E,F])}}})}else{y.rejectWith(this,[B,C])}},function(A){z(A,x)})})}function p(x,y){return r(function(z){return z[x].apply(z,y)})}function o(x,z,y){return r(function(B){var A=B.index(z);return A[x].apply(A[x],y)})}var v=["add","delete","get","put","clear","count","each"];for(var q=0;q<v.length;q++){w[v[q]]=(function(x){return function(){return p(x,arguments)}})(v[q])}w.index=function(x){return{"each":function(A,y,z){return o("each",x,[A,y,z])},"eachKey":function(A,y,z){return o("eachKey",x,[A,y,z])},"get":function(y){return o("get",x,[y])},"count":function(){return o("count",x,[])},"getKey":function(y){return o("getKey",x,[y])}}};return w}})}});f.indexedDB.IDBCursor=e;f.indexedDB.IDBTransaction=d;f.idb=f.indexedDB})(jQuery);